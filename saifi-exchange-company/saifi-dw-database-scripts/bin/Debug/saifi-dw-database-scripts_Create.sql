/*
Deployment script for saifi-dw-database-scripts

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "saifi-dw-database-scripts"
:setvar DefaultFilePrefix "saifi-dw-database-scripts"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [PRIMARY_1], FILENAME = '$(DefaultDataPath)$(DefaultFilePrefix)_PRIMARY_1.ndf'), 
    FILEGROUP [DataFG](NAME = [DataFG_1], FILENAME = '$(DefaultDataPath)$(DefaultFilePrefix)_DataFG_1.ndf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
PRINT N'Creating [MTFG2018]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [MTFG2018];


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [MTFG2018_1A757FC3], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_MTFG2018_1A757FC3.mdf') TO FILEGROUP [MTFG2018];


GO
PRINT N'Creating [MTFG2017]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [MTFG2017];


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [MTFG2017_45397B68], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_MTFG2017_45397B68.mdf') TO FILEGROUP [MTFG2017];


GO
PRINT N'Creating [MTFG2016]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [MTFG2016];


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [MTFG2016_763DDCA5], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_MTFG2016_763DDCA5.mdf') TO FILEGROUP [MTFG2016];


GO
PRINT N'Creating [MTFG0000]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [MTFG0000];


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [MTFG0000_A14116A], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_MTFG0000_A14116A.mdf') TO FILEGROUP [MTFG0000];


GO
ALTER DATABASE [$(DatabaseName)]
    MODIFY FILEGROUP [DataFG] DEFAULT;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY SIMPLE,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = PARTIAL,
                NESTED_TRIGGERS = ON,
                TRANSFORM_NOISE_WORDS = OFF,
                TWO_DIGIT_YEAR_CUTOFF = 2049 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [MT]...';


GO
CREATE SCHEMA [MT]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [MT_PF_YEAR]...';


GO
CREATE PARTITION FUNCTION [MT_PF_YEAR](INT)
    AS RANGE RIGHT
    FOR VALUES (2016, 2017, 2018);


GO
PRINT N'Creating [MT_PS_FACT]...';


GO
CREATE PARTITION SCHEME [MT_PS_FACT]
    AS PARTITION [MT_PF_YEAR]
    TO ([MTFG0000], [MTFG2016], [MTFG2017], [MTFG2018]);


GO
PRINT N'Creating [dbo].[FactMoneyTransfer]...';


GO
CREATE TABLE [dbo].[FactMoneyTransfer] (
    [BranchKey]               INT           NOT NULL,
    [ProductKey]              INT           NOT NULL,
    [ChannelKey]              INT           NOT NULL,
    [TransactionDateKey]      INT           NOT NULL,
    [EmployeeKey]             INT           NULL,
    [TellerUserId]            VARCHAR (256) NULL,
    [ReceivedCurrencyKey]     INT           NOT NULL,
    [PayoutCurrencyKey]       INT           NOT NULL,
    [PartnerBranchKey]        INT           NULL,
    [SenderApplicantKey]      BIGINT        NOT NULL,
    [BeneficiaryApplicantKey] BIGINT        NOT NULL,
    [TransControlNumber]      VARCHAR (25)  NULL,
    [InwardOutwardFlag]       VARCHAR (15)  NOT NULL,
    [TransPurposeDetail]      VARCHAR (120) NULL,
    [TransStatus]             CHAR (1)      NULL,
    [TransReference]          VARCHAR (25)  NULL,
    [ReceivedTotalAmount]     MONEY         NULL,
    [ReceivedChargeAmount]    MONEY         NULL,
    [ReceivedNetAmount]       MONEY         NULL,
    [PayoutTotalAmount]       MONEY         NULL,
    [PayoutChargeAmount]      MONEY         NULL,
    [PayoutNetAmount]         MONEY         NULL,
    [ExchangeRate]            FLOAT (53)    NULL,
    [ServiceFeeAmt]           MONEY         NULL,
    [HeadquarterFeePct]       FLOAT (53)    NULL,
    [PartnerFeeAmt]           MONEY         NULL,
    [FeeDiscountAmt]          FLOAT (53)    NULL,
    [TaxAmt]                  MONEY         NULL,
    [PartitioningYear]        INT           NOT NULL,
    [InsertAuditKey]          INT           NOT NULL,
    [UpdateAuditKey]          INT           NOT NULL
) ON [MT_PS_FACT] ([PartitioningYear]);


GO
PRINT N'Creating [dbo].[DimApplicant]...';


GO
CREATE TABLE [dbo].[DimApplicant] (
    [ApplicantKey]           BIGINT        IDENTITY (1, 1) NOT NULL,
    [GeographyKey]           INT           NULL,
    [IdentificationDocNo]    VARCHAR (25)  NOT NULL,
    [MobileNumber]           VARCHAR (30)  NOT NULL,
    [CustomerNumber]         VARCHAR (25)  NULL,
    [FullName]               VARCHAR (120) NOT NULL,
    [Address]                VARCHAR (120) NOT NULL,
    [CountryBirthCode]       VARCHAR (3)   NULL,
    [CountryCitizenshipCode] VARCHAR (3)   NULL,
    [DateOfBirth]            DATE          NULL,
    [CustomerSegment]        VARCHAR (15)  NULL,
    [BankName]               VARCHAR (50)  NULL,
    [BankAddress]            VARCHAR (120) NULL,
    [BankSwiftID]            VARCHAR (4)   NULL,
    [BankSwiftLocation]      VARCHAR (2)   NULL,
    [BankSwiftBranch]        VARCHAR (3)   NULL,
    [AccountName]            VARCHAR (50)  NULL,
    [AccountNo]              VARCHAR (30)  NULL,
    [ChequeNo]               VARCHAR (30)  NULL,
    [RowIsCurrent]           BIT           NOT NULL,
    [RowStartDate]           DATETIME      NOT NULL,
    [RowEndDate]             DATETIME      NOT NULL,
    [InsertAuditKey]         INT           NOT NULL,
    [UpdateAuditKey]         INT           NOT NULL,
    CONSTRAINT [PK_dbo.DimApplicant] PRIMARY KEY CLUSTERED ([ApplicantKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimAudit]...';


GO
CREATE TABLE [dbo].[DimAudit] (
    [AuditKey]                INT              IDENTITY (1, 1) NOT NULL,
    [ParentAuditKey]          INT              NOT NULL,
    [TableName]               VARCHAR (50)     NOT NULL,
    [PkgName]                 VARCHAR (50)     NOT NULL,
    [PkgGUID]                 UNIQUEIDENTIFIER NULL,
    [PkgVersionGUID]          UNIQUEIDENTIFIER NULL,
    [PkgVersionMajor]         SMALLINT         NULL,
    [PkgVersionMinor]         SMALLINT         NULL,
    [ExecStartDT]             DATETIME         NOT NULL,
    [ExecStopDT]              DATETIME         NULL,
    [ExecutionInstanceGUID]   UNIQUEIDENTIFIER NULL,
    [ExtractRowCnt]           BIGINT           NULL,
    [InsertRowCnt]            BIGINT           NULL,
    [UpdateRowCnt]            BIGINT           NULL,
    [ErrorRowCnt]             BIGINT           NULL,
    [TableInitialRowCnt]      BIGINT           NULL,
    [TableFinalRowCnt]        BIGINT           NULL,
    [TableMaxSurrogateKey]    BIGINT           NULL,
    [TableMaxDateTime]        DATETIME         NULL,
    [SuccessfulProcessingInd] CHAR (1)         NOT NULL,
    CONSTRAINT [PK_dbo.DimAudit] PRIMARY KEY CLUSTERED ([AuditKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimScenario]...';


GO
CREATE TABLE [dbo].[DimScenario] (
    [ScenarioKey]        INT          IDENTITY (1, 1) NOT NULL,
    [ScenarioCode]       VARCHAR (40) NOT NULL,
    [ScenarioDesc]       VARCHAR (60) NULL,
    [ActualScenarioFlag] CHAR (1)     NULL,
    [AuditKey]           INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimScenario] PRIMARY KEY CLUSTERED ([ScenarioKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimDate]...';


GO
CREATE TABLE [dbo].[DimDate] (
    [DateKey]          INT          NOT NULL,
    [Date]             DATETIME     NOT NULL,
    [FiscalPeriodID]   INT          NULL,
    [FullDate]         VARCHAR (30) NULL,
    [DayOfWeek]        TINYINT      NULL,
    [DayName]          NCHAR (10)   NULL,
    [DayOfMonth]       TINYINT      NULL,
    [DayOfYear]        SMALLINT     NULL,
    [WeekOfYear]       TINYINT      NULL,
    [MonthName]        NCHAR (10)   NULL,
    [MonthOfYear]      TINYINT      NULL,
    [Quarter]          TINYINT      NULL,
    [QuarterName]      NCHAR (10)   NULL,
    [Year]             INT          NULL,
    [YearName]         NCHAR (7)    NULL,
    [YYYYMM]           INT          NULL,
    [IsAWeekday]       BIT          NULL,
    [EOMFlag]          BIT          NULL,
    [IsCurrentDay]     BIT          NULL,
    [IsFiscalMonthEnd] BIT          NULL,
    [AuditKey]         INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimDate] PRIMARY KEY CLUSTERED ([DateKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimCurrency]...';


GO
CREATE TABLE [dbo].[DimCurrency] (
    [CurrencyKey]                  INT             IDENTITY (1, 1) NOT NULL,
    [CurrencyAlternateKey]         CHAR (3)        NOT NULL,
    [CurrencyNumber]               VARCHAR (3)     NOT NULL,
    [CurrencySwiftCode]            CHAR (3)        NULL,
    [CurrencyName]                 VARCHAR (60)    NULL,
    [CurrencyFullName]             VARCHAR (120)   NULL,
    [Currency_Decimal]             CHAR (1)        NULL,
    [Currency_Display_Factor]      DECIMAL (10, 5) NULL,
    [Local_Currency_Flag]          CHAR (1)        NULL,
    [Group_Currency_Flag]          CHAR (1)        NULL,
    [Member_Currency_Flag]         CHAR (1)        NULL,
    [Currency_Thousands_Separator] VARCHAR (8)     NULL,
    [Currency_Decimal_Separator]   VARCHAR (8)     NULL,
    [Currency_ISO_Symbol]          VARCHAR (60)    NULL,
    [RowIsCurrent]                 BIT             NOT NULL,
    [RowStartDate]                 DATETIME        NOT NULL,
    [RowEndDate]                   DATETIME        NOT NULL,
    [InsertAuditKey]               INT             NOT NULL,
    [UpdateAuditKey]               INT             NOT NULL,
    CONSTRAINT [PK_dbo.DimCurrency] PRIMARY KEY CLUSTERED ([CurrencyKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimBranch]...';


GO
CREATE TABLE [dbo].[DimBranch] (
    [BranchKey]             INT           IDENTITY (1, 1) NOT NULL,
    [ParentBranchKey]       INT           NULL,
    [GeographyKey]          INT           NULL,
    [BranchAlternateKey]    VARCHAR (15)  NOT NULL,
    [BusinessType]          VARCHAR (20)  NOT NULL,
    [BranchName]            VARCHAR (50)  NOT NULL,
    [BranchFullName]        VARCHAR (120) NULL,
    [StreetAddressLines]    VARCHAR (140) NULL,
    [Phone]                 VARCHAR (30)  NULL,
    [Fax]                   VARCHAR (30)  NULL,
    [NumberEmployees]       INT           NULL,
    [OpenedDate]            DATE          NULL,
    [OrganizationName]      VARCHAR (50)  NOT NULL,
    [BranchRegionKey]       INT           NULL,
    [PercentageOfOwnership] VARCHAR (16)  NULL,
    [RowIsCurrent]          BIT           NOT NULL,
    [RowStartDate]          DATETIME      NOT NULL,
    [RowEndDate]            DATETIME      NOT NULL,
    [InsertAuditKey]        INT           NOT NULL,
    [UpdateAuditKey]        INT           NOT NULL,
    CONSTRAINT [PK_dbo.DimBranch] PRIMARY KEY CLUSTERED ([BranchKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimGeography]...';


GO
CREATE TABLE [dbo].[DimGeography] (
    [GeographyKey]      INT          IDENTITY (1, 1) NOT NULL,
    [City]              VARCHAR (30) NULL,
    [StateProvinceCode] VARCHAR (3)  NULL,
    [StateProvinceName] VARCHAR (50) NULL,
    [CountryCode]       VARCHAR (3)  NULL,
    [CountryName]       VARCHAR (50) NULL,
    [PostalCode]        VARCHAR (15) NULL,
    [RegionKey]         INT          NULL,
    [IpAddressLocator]  VARCHAR (15) NULL,
    [RowIsCurrent]      BIT          NOT NULL,
    [RowStartDate]      DATETIME     NOT NULL,
    [RowEndDate]        DATETIME     NOT NULL,
    [InsertAuditKey]    INT          NOT NULL,
    [UpdateAuditKey]    INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimGeography] PRIMARY KEY CLUSTERED ([GeographyKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimRegion]...';


GO
CREATE TABLE [dbo].[DimRegion] (
    [RegionKey]      INT          IDENTITY (1, 1) NOT NULL,
    [RegionID]       INT          NOT NULL,
    [RegionDesc]     VARCHAR (50) NOT NULL,
    [RegionGroup]    VARCHAR (50) NULL,
    [RowIsCurrent]   BIT          NOT NULL,
    [RowStartDate]   DATETIME     NOT NULL,
    [RowEndDate]     DATETIME     NOT NULL,
    [InsertAuditKey] INT          NOT NULL,
    [UpdateAuditKey] INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimRegion] PRIMARY KEY CLUSTERED ([RegionKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimChannel]...';


GO
CREATE TABLE [dbo].[DimChannel] (
    [ChannelKey]       INT          IDENTITY (1, 1) NOT NULL,
    [ChannelID]        VARCHAR (25) NOT NULL,
    [ChannelDesc]      VARCHAR (50) NOT NULL,
    [ChannelType]      VARCHAR (25) NULL,
    [ChannelClassID]   VARCHAR (25) NOT NULL,
    [ChannelClassDesc] VARCHAR (50) NOT NULL,
    [RowIsCurrent]     BIT          NOT NULL,
    [RowStartDate]     DATETIME     NOT NULL,
    [RowEndDate]       DATETIME     NOT NULL,
    [InsertAuditKey]   INT          NOT NULL,
    [UpdateAuditKey]   INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimChannel] PRIMARY KEY CLUSTERED ([ChannelKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimEmployee]...';


GO
CREATE TABLE [dbo].[DimEmployee] (
    [EmployeeKey]             INT             IDENTITY (1, 1) NOT NULL,
    [EmployeeId]              VARCHAR (25)    NOT NULL,
    [EmployeeNationalID]      VARCHAR (15)    NULL,
    [FullName]                VARCHAR (200)   NOT NULL,
    [LoginID]                 VARCHAR (256)   NOT NULL,
    [EmailAddress]            VARCHAR (50)    NOT NULL,
    [Phone]                   VARCHAR (25)    NOT NULL,
    [JobTitle]                VARCHAR (50)    NOT NULL,
    [Department]              VARCHAR (50)    NOT NULL,
    [FtPtStatus]              VARCHAR (50)    NOT NULL,
    [BirthDateKey]            INT             NOT NULL,
    [HireDateKey]             INT             NOT NULL,
    [TermDateKey]             INT             NOT NULL,
    [SupervisorId]            INT             NOT NULL,
    [SupervisorNameLastFirst] VARCHAR (100)   NOT NULL,
    [BranchKey]               INT             NOT NULL,
    [MaritalStatus]           CHAR (1)        NULL,
    [Gender]                  CHAR (1)        NULL,
    [SalesPersonFlag]         BIT             NULL,
    [CurrentFlag]             BIT             NULL,
    [EmployeePhoto]           VARBINARY (MAX) NULL,
    [RowIsCurrent]            BIT             NOT NULL,
    [RowStartDate]            DATETIME        NOT NULL,
    [RowEndDate]              DATETIME        NOT NULL,
    [InsertAuditKey]          INT             NOT NULL,
    [UpdateAuditKey]          INT             NOT NULL,
    CONSTRAINT [PK_dbo.DimEmployee] PRIMARY KEY CLUSTERED ([EmployeeKey] ASC)
);


GO
PRINT N'Creating [dbo].[DimProduct]...';


GO
CREATE TABLE [dbo].[DimProduct] (
    [ProductKey]        INT          IDENTITY (1, 1) NOT NULL,
    [ProductID]         VARCHAR (25) NULL,
    [ProductDesc]       VARCHAR (50) NULL,
    [ProductLineID]     VARCHAR (25) NULL,
    [ProductLineDesc]   VARCHAR (50) NULL,
    [ProductFamilyID]   VARCHAR (25) NULL,
    [ProductFamilyDesc] VARCHAR (50) NULL,
    [RowIsCurrent]      BIT          NOT NULL,
    [RowStartDate]      DATETIME     NOT NULL,
    [RowEndDate]        DATETIME     NOT NULL,
    [InsertAuditKey]    INT          NOT NULL,
    [UpdateAuditKey]    INT          NOT NULL,
    CONSTRAINT [PK_dbo.DimProduct] PRIMARY KEY CLUSTERED ([ProductKey] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 'A' FOR [TransStatus];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT '1' FOR [TransReference];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [ReceivedTotalAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [ReceivedChargeAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [ReceivedNetAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [PayoutTotalAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [PayoutChargeAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [PayoutNetAmount];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 1 FOR [ExchangeRate];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [ServiceFeeAmt];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [HeadquarterFeePct];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [PartnerFeeAmt];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [FeeDiscountAmt];


GO
PRINT N'Creating unnamed constraint on [dbo].[FactMoneyTransfer]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD DEFAULT 0 FOR [TaxAmt];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimApplicant]...';


GO
ALTER TABLE [dbo].[DimApplicant]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimAudit]...';


GO
ALTER TABLE [dbo].[DimAudit]
    ADD DEFAULT 'Unknown' FOR [TableName];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimAudit]...';


GO
ALTER TABLE [dbo].[DimAudit]
    ADD DEFAULT 'Unknown' FOR [PkgName];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimAudit]...';


GO
ALTER TABLE [dbo].[DimAudit]
    ADD DEFAULT getdate() FOR [ExecStartDT];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimAudit]...';


GO
ALTER TABLE [dbo].[DimAudit]
    ADD DEFAULT 'N' FOR [SuccessfulProcessingInd];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimScenario]...';


GO
ALTER TABLE [dbo].[DimScenario]
    ADD DEFAULT 'N' FOR [ActualScenarioFlag];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimDate]...';


GO
ALTER TABLE [dbo].[DimDate]
    ADD DEFAULT 1 FOR [IsAWeekday];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimDate]...';


GO
ALTER TABLE [dbo].[DimDate]
    ADD DEFAULT 0 FOR [EOMFlag];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimDate]...';


GO
ALTER TABLE [dbo].[DimDate]
    ADD DEFAULT 0 FOR [IsCurrentDay];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimDate]...';


GO
ALTER TABLE [dbo].[DimDate]
    ADD DEFAULT 0 FOR [IsFiscalMonthEnd];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT 1 FOR [Currency_Display_Factor];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT 'N' FOR [Local_Currency_Flag];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT 'N' FOR [Group_Currency_Flag];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT 'default' FOR [Currency_Thousands_Separator];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT 'default' FOR [Currency_Decimal_Separator];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimCurrency]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimBranch]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimGeography]...';


GO
ALTER TABLE [dbo].[DimGeography]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimRegion]...';


GO
ALTER TABLE [dbo].[DimRegion]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimChannel]...';


GO
ALTER TABLE [dbo].[DimChannel]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimEmployee]...';


GO
ALTER TABLE [dbo].[DimEmployee]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimProduct]...';


GO
ALTER TABLE [dbo].[DimProduct]
    ADD DEFAULT 1 FOR [RowIsCurrent];


GO
PRINT N'Creating unnamed constraint on [dbo].[DimProduct]...';


GO
ALTER TABLE [dbo].[DimProduct]
    ADD DEFAULT '12/31/9999' FOR [RowEndDate];


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_BranchKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_BranchKey] FOREIGN KEY ([BranchKey]) REFERENCES [dbo].[DimBranch] ([BranchKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_ProductKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_ProductKey] FOREIGN KEY ([ProductKey]) REFERENCES [dbo].[DimProduct] ([ProductKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_ChannelKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_ChannelKey] FOREIGN KEY ([ChannelKey]) REFERENCES [dbo].[DimChannel] ([ChannelKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_TransactionDateKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_TransactionDateKey] FOREIGN KEY ([TransactionDateKey]) REFERENCES [dbo].[DimDate] ([DateKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_EmployeeKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_EmployeeKey] FOREIGN KEY ([EmployeeKey]) REFERENCES [dbo].[DimEmployee] ([EmployeeKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_ReceivedCurrencyKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_ReceivedCurrencyKey] FOREIGN KEY ([ReceivedCurrencyKey]) REFERENCES [dbo].[DimCurrency] ([CurrencyKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_PayoutCurrencyKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_PayoutCurrencyKey] FOREIGN KEY ([PayoutCurrencyKey]) REFERENCES [dbo].[DimCurrency] ([CurrencyKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_PartnerBranchKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_PartnerBranchKey] FOREIGN KEY ([PartnerBranchKey]) REFERENCES [dbo].[DimBranch] ([BranchKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_SenderApplicantKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_SenderApplicantKey] FOREIGN KEY ([SenderApplicantKey]) REFERENCES [dbo].[DimApplicant] ([ApplicantKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_BeneficiaryApplicantKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_BeneficiaryApplicantKey] FOREIGN KEY ([BeneficiaryApplicantKey]) REFERENCES [dbo].[DimApplicant] ([ApplicantKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_FactMoneyTransfer_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[FactMoneyTransfer]
    ADD CONSTRAINT [FK_dbo_FactMoneyTransfer_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimApplicant_GeographyKey]...';


GO
ALTER TABLE [dbo].[DimApplicant]
    ADD CONSTRAINT [FK_dbo_DimApplicant_GeographyKey] FOREIGN KEY ([GeographyKey]) REFERENCES [dbo].[DimGeography] ([GeographyKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimApplicant_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimApplicant]
    ADD CONSTRAINT [FK_dbo_DimApplicant_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimApplicant_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimApplicant]
    ADD CONSTRAINT [FK_dbo_DimApplicant_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimAudit_ParentAuditKey]...';


GO
ALTER TABLE [dbo].[DimAudit]
    ADD CONSTRAINT [FK_dbo_DimAudit_ParentAuditKey] FOREIGN KEY ([ParentAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimScenario_AuditKey]...';


GO
ALTER TABLE [dbo].[DimScenario]
    ADD CONSTRAINT [FK_dbo_DimScenario_AuditKey] FOREIGN KEY ([AuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimDate_AuditKey]...';


GO
ALTER TABLE [dbo].[DimDate]
    ADD CONSTRAINT [FK_dbo_DimDate_AuditKey] FOREIGN KEY ([AuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimCurrency_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD CONSTRAINT [FK_dbo_DimCurrency_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimCurrency_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimCurrency]
    ADD CONSTRAINT [FK_dbo_DimCurrency_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimBranch_ParentBranchKey]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD CONSTRAINT [FK_dbo_DimBranch_ParentBranchKey] FOREIGN KEY ([ParentBranchKey]) REFERENCES [dbo].[DimBranch] ([BranchKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimBranch_GeographyKey]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD CONSTRAINT [FK_dbo_DimBranch_GeographyKey] FOREIGN KEY ([GeographyKey]) REFERENCES [dbo].[DimGeography] ([GeographyKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimBranch_BranchRegionKey]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD CONSTRAINT [FK_dbo_DimBranch_BranchRegionKey] FOREIGN KEY ([BranchRegionKey]) REFERENCES [dbo].[DimRegion] ([RegionKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimBranch_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD CONSTRAINT [FK_dbo_DimBranch_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimBranch_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimBranch]
    ADD CONSTRAINT [FK_dbo_DimBranch_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimGeography_RegionKey]...';


GO
ALTER TABLE [dbo].[DimGeography]
    ADD CONSTRAINT [FK_dbo_DimGeography_RegionKey] FOREIGN KEY ([RegionKey]) REFERENCES [dbo].[DimRegion] ([RegionKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimGeography_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimGeography]
    ADD CONSTRAINT [FK_dbo_DimGeography_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimGeography_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimGeography]
    ADD CONSTRAINT [FK_dbo_DimGeography_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimRegion_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimRegion]
    ADD CONSTRAINT [FK_dbo_DimRegion_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimRegion_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimRegion]
    ADD CONSTRAINT [FK_dbo_DimRegion_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimChannel_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimChannel]
    ADD CONSTRAINT [FK_dbo_DimChannel_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimChannel_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimChannel]
    ADD CONSTRAINT [FK_dbo_DimChannel_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimEmployee_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimEmployee]
    ADD CONSTRAINT [FK_dbo_DimEmployee_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimEmployee_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimEmployee]
    ADD CONSTRAINT [FK_dbo_DimEmployee_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimProduct_InsertAuditKey]...';


GO
ALTER TABLE [dbo].[DimProduct]
    ADD CONSTRAINT [FK_dbo_DimProduct_InsertAuditKey] FOREIGN KEY ([InsertAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [dbo].[FK_dbo_DimProduct_UpdateAuditKey]...';


GO
ALTER TABLE [dbo].[DimProduct]
    ADD CONSTRAINT [FK_dbo_DimProduct_UpdateAuditKey] FOREIGN KEY ([UpdateAuditKey]) REFERENCES [dbo].[DimAudit] ([AuditKey]);


GO
PRINT N'Creating [MT].[Applicant_v]...';


GO
CREATE VIEW [MT].[Applicant_v] AS 
SELECT [ApplicantKey] AS [Applicant Key]
, [GeographyKey] AS [Geography Key]
, [IdentificationDocNo] AS [Identification Doc No]
, [MobileNumber] AS [Mobile Number]
, [CustomerNumber] AS [Customer Number]
, [FullName] AS [Full Name]
, [Address] AS [Address]
, [CountryBirthCode] AS [Country of Birth Code]
, [CountryCitizenshipCode] AS [Country of Citizenship Code]
, [DateOfBirth] AS [Date of Birth]
, [CustomerSegment] AS [Customer Segment]
, [BankName] AS [Bank Name]
, [BankAddress] AS [Bank Address]
, [BankSwiftID] AS [BankSwiftID]
, [BankSwiftLocation] AS [BankSwiftLocation]
, [BankSwiftBranch] AS [BankSwiftBranch]
, [AccountName] AS [Account Name]
, [AccountNo] AS [Account Number]
, [ChequeNo] AS [Cheque No]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [Insert Audit Key]
, [UpdateAuditKey] AS [Update Audit Key]
FROM dbo.DimApplicant
GO
PRINT N'Creating [MT].[Scenario_v]...';


GO
CREATE VIEW [MT].[Scenario_v] AS 
SELECT [ScenarioKey] AS [Scenario Key]
, [ScenarioCode] AS [Scenario Code]
, [ScenarioDesc] AS [Scenario Description]
, [ActualScenarioFlag] AS [Actual Scenario Flag]
, [AuditKey] AS [Audit Key]
FROM dbo.DimScenario
GO
PRINT N'Creating [MT].[Date_v]...';


GO
CREATE VIEW [MT].[Date_v] AS 
SELECT [DateKey] AS [Date Key]
, [Date] AS [Date]
, [FiscalPeriodID] AS [Fiscal Period ID]
, [FullDate] AS [Full Date]
, [DayOfWeek] AS [Day In Week]
, [DayName] AS [Day Name]
, [DayOfMonth] AS [Day In Month]
, [DayOfYear] AS [Day In Year]
, [WeekOfYear] AS [Week In Year]
, [MonthName] AS [Month Name]
, [MonthOfYear] AS [Month Of Year]
, [Quarter] AS [Quarter]
, [QuarterName] AS [Quarter Name]
, [Year] AS [Year]
, [YearName] AS [Year Name]
, [YYYYMM] AS [YYYYMM]
, [IsAWeekday] AS [Is Weekday]
, [EOMFlag] AS [Month End Flag]
, [IsCurrentDay] AS [Is Current Day]
, [IsFiscalMonthEnd] AS [Is Fiscal Month End]
, [AuditKey] AS [Audit Key]
FROM dbo.DimDate
GO
PRINT N'Creating [MT].[Currency_v]...';


GO
CREATE VIEW [MT].[Currency_v] AS 
SELECT [CurrencyKey] AS [Currency Key]
, [CurrencyAlternateKey] AS [Currency Alternate Key]
, [CurrencyNumber] AS [Currency Number]
, [CurrencySwiftCode] AS [Currency Swift Code]
, [CurrencyName] AS [Currency Name]
, [CurrencyFullName] AS [Currency Full Name]
, [Currency_Decimal] AS [Currency Decimal]
, [Currency_Display_Factor] AS [Currency Display Factor]
, [Local_Currency_Flag] AS [Local Currency Flag]
, [Group_Currency_Flag] AS [Group Currency Flag]
, [Member_Currency_Flag] AS [Member Currency Flag]
, [Currency_Thousands_Separator] AS [Currency Thousands Separator]
, [Currency_Decimal_Separator] AS [Currency Decimal Separator]
, [Currency_ISO_Symbol] AS [Currency ISO Symbol]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]

, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimCurrency
GO
PRINT N'Creating [MT].[Branch_v]...';


GO
CREATE VIEW [MT].[Branch_v] AS 
SELECT [BranchKey] AS [Branch Key]
, [ParentBranchKey] AS [Parent Branch Key]
, [GeographyKey] AS [Geography Key]
, [BranchAlternateKey] AS [Branch Alternate Key]
, [BusinessType] AS [BusinessType]
, [BranchName] AS [Branch Name]
, [BranchFullName] AS [Branch Full Name]
, [StreetAddressLines] AS [Street Address Lines]
, [Phone] AS [Phone]
, [Fax] AS [Fax]
, [NumberEmployees] AS [Number of Employees]
, [OpenedDate] AS [Opened Date]
, [OrganizationName] AS [Organization Name]
, [BranchRegionKey] AS [RegionKey]
, [PercentageOfOwnership] AS [Percentage Of Ownership]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]

, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimBranch
GO
PRINT N'Creating [MT].[Geography_v]...';


GO
CREATE VIEW [MT].[Geography_v] AS 
SELECT [GeographyKey] AS [Geography Key]
, [City] AS [City]
, [StateProvinceCode] AS [StateProvinceCode]
, [StateProvinceName] AS [StateProvinceName]
, [CountryCode] AS [CountryCode]
, [CountryName] AS [CountryName]
, [PostalCode] AS [PostalCode]
, [RegionKey] AS [RegionKey]
, [IpAddressLocator] AS [IpAddressLocator]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimGeography
GO
PRINT N'Creating [MT].[Region_v]...';


GO
CREATE VIEW [MT].[Region_v] AS 
SELECT [RegionKey] AS [Region Key]
, [RegionID] AS [Region ID]
, [RegionDesc] AS [Region Description]
, [RegionGroup] AS [Region Group]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimRegion
GO
PRINT N'Creating [MT].[Channel_v]...';


GO
CREATE VIEW [MT].[Channel_v] AS 
SELECT [ChannelKey] AS [Channel Key]
, [ChannelID] AS [Channel ID]
, [ChannelDesc] AS [Channel Description]
, [ChannelType] AS [Channel Type]
, [ChannelClassID] AS [Channel Class ID]
, [ChannelClassDesc] AS [Channel Class Desc]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimChannel
GO
PRINT N'Creating [MT].[Employee_v]...';


GO
CREATE VIEW [MT].[Employee_v] AS 
SELECT [EmployeeKey] AS [Employee Key]
, [EmployeeId] AS [Employee ID]
, [EmployeeNationalID] AS [EmployeeNationalID]
, [FullName] AS [Full Name]
, [LoginID] AS [LoginID]
, [EmailAddress] AS [EmailAddress]
, [Phone] AS [Phone]
, [JobTitle] AS [Job Title]
, [Department] AS [Department]
, [FtPtStatus] AS [Full Time or Part Time]
, [BirthDateKey] AS [Date key for DOB]
, [HireDateKey] AS [Date key for Hire Date]
, [TermDateKey] AS [Date key for Termination date]
, [SupervisorId] AS [Supervisor ID]
, [SupervisorNameLastFirst] AS [Supervisor Name Last First]
, [BranchKey] AS [BranchKey]
, [MaritalStatus] AS [MaritalStatus]
, [Gender] AS [Gender]
, [SalesPersonFlag] AS [SalesPersonFlag]
, [CurrentFlag] AS [CurrentFlag]
, [EmployeePhoto] AS [EmployeePhoto]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimEmployee
GO
PRINT N'Creating [MT].[Product_v]...';


GO
CREATE VIEW [MT].[Product_v] AS 
SELECT [ProductKey] AS [Product Key]
, [ProductID] AS [Product ID]
, [ProductDesc] AS [Product Description]
, [ProductLineID] AS [Product Line ID]
, [ProductLineDesc] AS [Product Line Description]
, [ProductFamilyID] AS [Product Family ID]
, [ProductFamilyDesc] AS [Product Family Description]
, [RowIsCurrent] AS [Row Is Current]
, [RowStartDate] AS [Row Start Date]
, [RowEndDate] AS [Row End Date]
, [InsertAuditKey] AS [InsertAuditKey]
, [UpdateAuditKey] AS [UpdateAuditKey]
FROM dbo.DimProduct
GO
PRINT N'Creating [MT].[MoneyTransfer_v]...';


GO
CREATE VIEW [MT].[MoneyTransfer_v] AS 
SELECT [BranchKey] AS [Branch Key]
, [ProductKey] AS [Product Key]
, [ChannelKey] AS [Channel Key]
, [TransactionDateKey] AS [Transaction Date Key]
, [EmployeeKey] AS [Employee Key]
, [TellerUserId] AS [Teller User ID]
, [ReceivedCurrencyKey] AS [Received Currency Key]
, [PayoutCurrencyKey] AS [Payout Currency Key]
, [PartnerBranchKey] AS [Partner Branch Key]
, [SenderApplicantKey] AS [Sender Applicant Key]
, [BeneficiaryApplicantKey] AS [Beneficiary Applicant Key]
, [TransControlNumber] AS [Transaction Control Number]
, [InwardOutwardFlag] AS [InwardOutwardFlag]
, [TransPurposeDetail] AS [Transaction Purpose Detail]
, [TransStatus] AS [TransactionStatus]
, [TransReference] AS [Transaction Reference]
, [ReceivedTotalAmount] AS [ReceivedTotalAmount]
, [ReceivedChargeAmount] AS [ReceivedChargeAmount]
, [ReceivedNetAmount] AS [ReceivedNetAmount]
, [PayoutTotalAmount] AS [PayoutTotalAmount]
, [PayoutChargeAmount] AS [PayoutChargeAmount]
, [PayoutNetAmount] AS [PayoutNetAmount]
, [ExchangeRate] AS [Exchange Rate]
, [ServiceFeeAmt] AS [Service Fee Amount]
, [HeadquarterFeePct] AS [Headquarter Fee Percent]
, [PartnerFeeAmt] AS [Partner Fee Amount]
, [FeeDiscountAmt] AS [Fee Discount Amount]
, [TaxAmt] AS [Tax Amount]
, [PartitioningYear] AS [Partitioning Year]
, [InsertAuditKey] AS [Insert Audit Key]
, [UpdateAuditKey] AS [Update Audit Key]
FROM dbo.FactMoneyTransfer
GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET MULTI_USER 
    WITH ROLLBACK IMMEDIATE;


GO
PRINT N'Update complete.';


GO
